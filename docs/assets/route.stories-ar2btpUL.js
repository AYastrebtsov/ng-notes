import{j as e}from"./jsx-runtime-_e34SzbC.js";import{T as z,D as H}from"./index-CINyIF1m.js";import{h,d as c,H as m,c as R,a as V,u as A,b as x,C as L,o as T,g as F}from"./getBeginRegistrer-O-RCh74C.js";import{u as K,a as f,s as U,c as J,b as q}from"./store-Ew_vBLzJ.js";import{c as Q}from"./utils-vGQRoZUn.js";import{r as S}from"./index-DVXBtNgz.js";import{I as G}from"./IntroHeader-CbAXIbrA.js";import{I as W}from"./InfoLink-CVaGZN8I.js";import{S as X}from"./StyledButton-BgRVrqu0.js";import{S as Z}from"./StyledOptInput-BUBcZ6gL.js";import{S as Y}from"./StyledRipple-tGUsU2an.js";import{u as O}from"./index-RDOGhiKV.js";import{P as $}from"./Provider-B2JF8s1Z.js";import"./iframe-I_zNIZEh.js";import"../sb-preview/runtime.js";import"./index-CGNRONEi.js";import"./mapValues-CKVDuP6u.js";import"./index-RMSiDl4v.js";import"./index-C-I6vmrZ.js";import"./index-DVuCPyz5.js";import"./index-DrFu-skq.js";import"./api.esm-Bl9pOvZA.js";import"./ripple.esm-C76k_Swo.js";import"./iconbase.esm-CpYqi65u.js";import"./extends-CCbyfPlC.js";const ee=async({api_token:r,code:o})=>{const a=new URL("https://premialoyality.ru/api/loymax/phoneCode");a.searchParams.append("api_token",r),a.searchParams.append("code",o);const n=await fetch(a);if(!n.ok)throw new Error("Произошел сбой запроса. Повторите попытку");const t=await n.json();if(t.status==="Error")throw new Error(t.result.result.message);if(t.result.result.state==="Error")throw new Error(t.result.result.message);if(t.result.data===void 0)throw new Error("Не удалось получить ответ");return t},_={result:{data:{token_type:"bearer",access_token:"qEolVCQ-UBzLFkob2xk2pQbGdh8ngx72kOXDjc6h345N5iKifee6G0biAPysrrmwP9Zly5HpoOZikI4hLmagsPP0qx9bHp3KuMTSpkzFQ8zXzJool1iMfy_wynVDdMd9s5CEKYQpvDDIcAL9zIrRU-vaM_ML843pPBPV3MJyrJreo8k5S7uaGH8k9EfZPLw9ujJoiVWtdIBk3zzJKq_PoK8M__M16BWOlz0nidP38kL4T2nqADNPctQHiJl4Hlzrl1eihSKb8dIcnuEahByzxBLrxfPIh3mVOzhj_54MJMCHWd2J5UXm7bc85dBkz2ueDd9XKzH0z7dqgZPIH58HpiPYCQExcspNAKk-umP3kBG80yVZw02iFBUnM_WsKPpNP_i4gUE5D4WsXB1lDoQIYeEWAUUrEynhYBNmFFShTRI",refresh_token:"5ba5163545d54f29a35ed65b469afb41",expires_in:2592e3},result:{state:"Success",httpCode:200,message:null,messageCode:null,exception:null,validationErrors:null}},status:"Success"},P={result:{result:{state:"Error",httpCode:400,message:"Неправильный код подтверждения. Осталось 6 попыток.",messageCode:null,exception:null,validationErrors:null}},status:"Error"};h.get("https://premialoyality.ru/api/loymax/phoneCode",async({request:r})=>new URL(r.url).searchParams.get("scenario")==="error"?(await c(2e3),m.json(P)):(await c(2e3),m.json(_)));const re=R({code:V().length(4).required()}),te=(r,o)=>r===void 0&&o===null?"Введите код безопасности":r!==void 0&&o===null?"Укажите код полностью":r===void 0&&o!==null||r!==void 0&&o!==null?"Неверный код безопасности":"Введите код безопасности";function w(){const r=K(),o=O(),a=f(s=>s.user.apiToken),n=f(s=>s.user.phoneValue),[t,p]=S.useState(60),{handleSubmit:v,control:M,reset:D,formState:{errors:d}}=A({defaultValues:{code:""},resolver:T(re)}),{mutate:N,error:u,isPending:C}=x({mutationFn:ee,onSuccess:s=>{o("/registration")},onError:()=>{D()}}),{mutate:B}=x({mutationFn:F,onSuccess:s=>{o("/registration")}});return S.useEffect(()=>{const s=setInterval(()=>{t>0&&p(t-1)},1e3);return()=>clearInterval(s)},[t]),e.jsxs("div",{className:"h-dvh flex flex-col",children:[e.jsx(G,{arrowAction:()=>{o(-1)},closeAction:()=>{o(-1)},className:"px-2 pt-2"}),e.jsxs("div",{className:"flex flex-col flex-grow px-3 pb-7 pt-[14px]",children:[e.jsxs("h1",{className:"pb-6 font-Inter text-base/5 font-bold text-212121",children:["Вы получите смс на номер",e.jsx("br",{})," ",n]}),e.jsx("p",{className:Q("pb-[14px] font-Inter text-[0.688rem]/[0.875rem] font-medium text-8D929A",{"text-D50032":d.code},{"text-D50032":u}),children:te(d.code,u)}),e.jsxs("form",{onSubmit:v(s=>{console.log(s),r(U(s.code)),N({api_token:a||"",code:s.code})}),className:"flex flex-col flex-grow",children:[e.jsx(L,{name:"code",control:M,defaultValue:"",render:({field:s})=>e.jsx(Z,{error:d.code?!0:u!==null,...s})}),e.jsx(X,{type:"submit",label:"Далее",loading:C,className:"mt-auto"})]}),e.jsxs("button",{disabled:t!==0,className:"relative border-0 min-h-9 rounded-md overflow-hidden font-Inter text-xs/[1.125rem] font-medium disabled:text-8D929A text-D50032 text-center mt-[18px]",onClick:()=>{p(60),B(n.replace(/\D/g,""))},children:[t!==0?`Не получили СМС? Повторная отправка возможна через ${t} секунд`:"Отправить код повторно",e.jsx(Y,{pt:{root:{style:{background:"rgba(145, 47, 70, 0.3)"}}}})]}),e.jsx(W,{className:"m-auto mt-[10px]",to:"/info",text:"Инфо"})]})]})}w.__docgenInfo={description:"",methods:[],displayName:"Sms"};const I=({children:r})=>e.jsx($,{store:J({reducer:{user:q({name:"user",initialState:{apiToken:"mock_api_tocken_123456789",phoneValue:"+7 915 457 24 90"},reducers:{}}).reducer}}),children:r}),ve={title:"Страницы/Sms",component:w,tags:["autodocs"],parameters:{layout:{padded:!1},docs:{page:()=>e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(H,{})]}),description:{component:`<p>Адрес страницы: /sms</p>
<p>Используемые запросы:</p>
<p>getSendSms() - VITE_SEND_SMS - https://premialoyality.ru/api/loymax/phoneCode</p>
<p>getBeginRegister() - VITE_BEGIN_REGISTER - https://premialoyality.ru/api/loymax/beginRegister</p>`}}}},i={name:"Sms",decorators:[r=>e.jsx(I,{children:r()})],parameters:{msw:{handlers:{auth:h.get("https://premialoyality.ru/api/loymax/phoneCode",async()=>(await c(2e3),m.json(_)))}}}},l={name:"Sms - ошибка",decorators:[r=>e.jsx(I,{children:r()})],parameters:{msw:{handlers:{auth:h.get("https://premialoyality.ru/api/loymax/phoneCode",async()=>(await c(2e3),m.json(P)))}}}};var y,g,E;i.parameters={...i.parameters,docs:{...(y=i.parameters)==null?void 0:y.docs,source:{originalSource:`{
  name: 'Sms',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: {
        auth: http.get(import.meta.env.VITE_SEND_SMS, async () => {
          await delay(2000);
          return HttpResponse.json(responseSuccess);
        })
      }
    }
  }
}`,...(E=(g=i.parameters)==null?void 0:g.docs)==null?void 0:E.source}}};var j,k,b;l.parameters={...l.parameters,docs:{...(j=l.parameters)==null?void 0:j.docs,source:{originalSource:`{
  name: 'Sms - ошибка',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: {
        auth: http.get(import.meta.env.VITE_SEND_SMS, async () => {
          await delay(2000);
          return HttpResponse.json(responseError);
        })
      }
    }
  }
}`,...(b=(k=l.parameters)==null?void 0:k.docs)==null?void 0:b.source}}};const Me=["Primary","PrimaryError"];export{i as Primary,l as PrimaryError,Me as __namedExportsOrder,ve as default};
