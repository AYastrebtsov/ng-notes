import{j as e}from"./jsx-dev-runtime-BETcGmrp.js";import{T as L}from"./index-BeJuocB0.js";import{h as a,H as i}from"./index-Dt5PkBs3.js";import{u as b,c as H,a as $}from"./store-Z64qRVOu.js";import{u as B,L as q,B as W}from"./index-JTdNR3QG.js";import{c as z}from"./utils-Bgs-dzIv.js";import{r as f}from"./index-BdMw_Ax9.js";import{u as N}from"./useMutation-Djmu82TW.js";import{u as G,C as J}from"./index.esm-aGtwzpR0.js";import{c as K,a as Q,o as X}from"./object-BGxo6DNn.js";import{I as Y}from"./IntroHeader-DCiaQ80g.js";import{I as Z}from"./InfoLink-C8LO3gVV.js";import{S as ee}from"./StyledButton-BfTgqHe6.js";import{S as re}from"./StyledOptInput-bocisnaV.js";import{S as E}from"./StyledRipple-UT5xWoNU.js";import{u as te}from"./StyledToast-ChYbD6sG.js";import{n as o}from"./index-Cg6HFJ9R.js";import{p as se,r as oe,a as ae}from"./postSendEmailCode-DupwMTTS.js";import{p as ie,r as ne,a as me}from"./postRepeatEmailCode-CFiaYdv4.js";import{p as le,r as ue}from"./postUpdateUserInfo-BdjCGWJc.js";import{P as ce}from"./Provider-BJPChQtn.js";import{d as n}from"./delay-DW_e480v.js";import"./iframe-DfDEsFaS.js";import"../sb-preview/runtime.js";import"./index-BSE0ybse.js";import"./mapValues-BXPElCjX.js";import"./index-BU6WCtrf.js";import"./index-C-I6vmrZ.js";import"./index-BvvlT_10.js";import"./index-DrFu-skq.js";import"./index-zmhHS-aW.js";import"./mutation-B5pq8hhe.js";import"./QueryClientProvider-DLasFzzO.js";import"./jsx-runtime-B_9IJGoR.js";import"./utils-km2FGkQ4.js";import"./ArrowIcon-DVFHFDWJ.js";import"./CloseIcon-BosYNr9-.js";import"./api.esm-CK-Pl4SF.js";import"./ripple.esm-CEskJZ5p.js";import"./portal.esm-CvrWT0gn.js";import"./index-ByRWxq36.js";const j=({className:t})=>e.jsxDEV("svg",{className:t,width:"38",height:"38",viewBox:"0 0 38 38",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxDEV("circle",{cx:"19",cy:"19",r:"19",fill:"#A1C441"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/icons/ConfirmIcon.tsx",lineNumber:3,columnNumber:5},void 0),e.jsxDEV("path",{d:"M11.6111 19.2988L16.8359 24.5235L27.2842 14.074",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/icons/ConfirmIcon.tsx",lineNumber:4,columnNumber:5},void 0)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/icons/ConfirmIcon.tsx",lineNumber:2,columnNumber:3},void 0);j.__docgenInfo={description:"",methods:[],displayName:"ConfirmIcon",props:{className:{required:!1,tsType:{name:"string"},description:""}}};const pe=K({code:Q().required("Введите код безопасности").length(4,"Укажите код полностью")});function S(){var h;const t=B(),{StyledToast:V,showToast:c}=te(),m=b(r=>r.user.apiToken),p=b(r=>r.user.email),[s,x]=f.useState(60),[I,g]=f.useState(!1),{handleSubmit:T,control:C,reset:P,formState:{errors:d}}=G({defaultValues:{code:""},resolver:X(pe)}),{mutate:O,isPending:A}=N({mutationFn:le,onSuccess:()=>{g(!0)}}),{mutate:R,isPending:F}=N({mutationFn:se,onSuccess:()=>{O({api_token:m||"",fields:{check_email:!0,email:p}})},onError:r=>{c({variant:"info",text:r.message}),P()}}),{mutate:M}=N({mutationFn:ie,onMutate:()=>{c({variant:"info",text:"Код повторно отправлен на указанный Вами email"})},onError:r=>{c({variant:"info",text:r.message})}});return f.useEffect(()=>{const r=setInterval(()=>{s>0&&x(s-1)},1e3);return()=>clearInterval(r)},[s]),e.jsxDEV("div",{className:"flex h-dvh flex-col",children:[null,e.jsxDEV(Y,{arrowAction:()=>{t(-1)},closeAction:()=>{t(-1)},className:"px-2 pt-2"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:109,columnNumber:7},this),e.jsxDEV("div",{className:"flex flex-grow flex-col px-3 pb-7 pt-[14px]",children:[e.jsxDEV("h1",{className:"pb-6 font-Inter text-base/5 font-bold text-212121",children:["Вы получите код на почту",e.jsxDEV("br",{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:122,columnNumber:11},this)," ",p]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:120,columnNumber:9},this),e.jsxDEV("p",{className:z("pb-[14px] font-Inter text-[0.688rem]/[0.875rem] font-medium text-8D929A",{"text-D50032":d.code}),children:(h=d.code)==null?void 0:h.message},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:125,columnNumber:9},this),e.jsxDEV("form",{onSubmit:T(r=>{R({api_token:m||"",code:r.code})}),className:"flex flex-grow flex-col",children:[e.jsxDEV(J,{name:"code",control:C,defaultValue:"",render:({field:r})=>e.jsxDEV(re,{error:!!d.code,...r},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:146,columnNumber:36},this)},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:142,columnNumber:11},this),e.jsxDEV(ee,{loading:F||A,type:"submit",label:"Подтвердить",className:"mt-auto"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:149,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:133,columnNumber:9},this),e.jsxDEV("button",{disabled:s!==0,className:"relative mt-[18px] min-h-9 overflow-hidden rounded-md border-0 text-center font-Inter text-xs/[1.125rem] font-medium text-D50032 disabled:text-8D929A",onClick:()=>{x(60),M(p)},children:[s!==0?`Не получили код? Повторная отправка возможна через ${s} секунд`:"Отправить код повторно",e.jsxDEV(E,{pt:{root:{style:{background:"rgba(145, 47, 70, 0.3)"}}}},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:168,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:157,columnNumber:9},this),e.jsxDEV(Z,{className:"m-auto mt-[10px]",to:"/info",text:"Инфо"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:175,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:119,columnNumber:7},this),e.jsxDEV(V,{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:177,columnNumber:7},this),e.jsxDEV(o.Root,{dismissible:!1,open:I,children:e.jsxDEV(o.Portal,{children:[e.jsxDEV(o.Overlay,{className:"fixed inset-0 bg-black/35"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:181,columnNumber:11},this),e.jsxDEV(o.Content,{className:"fixed bottom-0 left-0 right-0",children:[e.jsxDEV("div",{className:"mx-auto mb-2 h-1 w-[38px] rounded-full bg-white opacity-75"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:183,columnNumber:13},this),e.jsxDEV("div",{className:"flex flex-col items-center rounded-t-[20px] bg-white pb-6 pl-3 pr-3 pt-7",children:[e.jsxDEV(j,{className:"mb-2"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:186,columnNumber:15},this),e.jsxDEV(o.Title,{className:"text-center font-Inter text-base/5 font-bold",children:"Почта подтверждена"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:188,columnNumber:15},this),e.jsxDEV(q,{to:"/select-store",className:"relative mt-7 w-full overflow-hidden rounded-lg bg-912F46 pb-[15px] pl-1 pr-1 pt-[15px] text-center font-Inter text-sm/[1.125rem] font-bold text-FFFFFF transition-colors active:bg-[#792035]",children:["Далее",e.jsxDEV(E,{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:195,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:190,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:185,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:182,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:180,columnNumber:9},this)},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:179,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.tsx",lineNumber:106,columnNumber:5},this)}S.__docgenInfo={description:"",methods:[],displayName:"ConfirmEmail"};const U=({children:t})=>e.jsxDEV(ce,{store:H({reducer:{user:$({name:"user",initialState:{apiToken:"mock_api_tocken_123456789",email:"Index@ya.ru"},reducers:{}}).reducer}}),children:t},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:24,columnNumber:3},void 0),er={title:"Страницы/Aутентификация/Подтверждение email",component:S,tags:["autodocs"],decorators:[W],parameters:{layout:{padded:!1},docs:{page:()=>e.jsxDEV(e.Fragment,{children:[e.jsxDEV(L,{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:54,columnNumber:11},void 0),e.jsxDEV("h2",{children:"Адрес страницы: /auth/confirm-email"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:56,columnNumber:11},void 0),e.jsxDEV("h3",{children:"Используемые запросы:"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:57,columnNumber:11},void 0),e.jsxDEV("p",{children:["postSendEmailCode() - VITE_POST_SEND_EMAIL_CODE - ","https://preprod.premiya.fivecorners.ru/api/loymax/confirmEmail"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:59,columnNumber:11},void 0),e.jsxDEV("p",{children:["postRepeatEmailCode() - VITE_POST_REPEAT_EMAIL_CODE - ","https://preprod.premiya.fivecorners.ru/api/loymax/newCodeSend"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:60,columnNumber:11},void 0),e.jsxDEV("p",{children:["postUpdateUserInfo() - VITE_POST_UPDATE_USER_INFO - ","https://preprod.premiya.fivecorners.ru/api/updateUserInfo"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:61,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:53,columnNumber:9},void 0)}}},l={name:"Подтверждение email",decorators:[t=>e.jsxDEV(U,{children:t()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:74,columnNumber:25},void 0)],parameters:{msw:{handlers:[a.post("https://preprod.premiya.fivecorners.ru/api/loymax/confirmEmail",async()=>(await n(2e3),i.json(oe))),a.post("https://preprod.premiya.fivecorners.ru/api/loymax/newCodeSend",async()=>(await n(2e3),i.json(ne))),a.post("https://preprod.premiya.fivecorners.ru/api/updateUserInfo",async()=>(await n(2e3),i.json(ue)))]}}},u={name:"Подтверждение email (ошибки)",decorators:[t=>e.jsxDEV(U,{children:t()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.confirm-email/route.stories.tsx",lineNumber:97,columnNumber:25},void 0)],parameters:{msw:{handlers:[a.post("https://preprod.premiya.fivecorners.ru/api/loymax/confirmEmail",async()=>(await n(2e3),i.json(ae))),a.post("https://preprod.premiya.fivecorners.ru/api/loymax/newCodeSend",async()=>(await n(2e3),i.json(me)))]}}};var y,D,v;l.parameters={...l.parameters,docs:{...(y=l.parameters)==null?void 0:y.docs,source:{originalSource:`{
  name: 'Подтверждение email',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.post(import.meta.env.VITE_POST_SEND_EMAIL_CODE, async () => {
        await delay(2000);
        return HttpResponse.json(responseSendEmailSuccess);
      }), http.post(import.meta.env.VITE_POST_REPEAT_EMAIL_CODE, async () => {
        await delay(2000);
        return HttpResponse.json(responseRepeatEmailSuccess);
      }), http.post(import.meta.env.VITE_POST_UPDATE_USER_INFO, async () => {
        await delay(2000);
        return HttpResponse.json(responseSuccess);
      })]
    }
  }
}`,...(v=(D=l.parameters)==null?void 0:D.docs)==null?void 0:v.source}}};var _,w,k;u.parameters={...u.parameters,docs:{...(_=u.parameters)==null?void 0:_.docs,source:{originalSource:`{
  name: 'Подтверждение email (ошибки)',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.post(import.meta.env.VITE_POST_SEND_EMAIL_CODE, async () => {
        await delay(2000);
        return HttpResponse.json(responseSendEmailError);
      }), http.post(import.meta.env.VITE_POST_REPEAT_EMAIL_CODE, async () => {
        await delay(2000);
        return HttpResponse.json(responseRepeatEmailError);
      })]
    }
  }
}`,...(k=(w=u.parameters)==null?void 0:w.docs)==null?void 0:k.source}}};const rr=["Primary","PrimaryError"];export{l as Primary,u as PrimaryError,rr as __namedExportsOrder,er as default};
