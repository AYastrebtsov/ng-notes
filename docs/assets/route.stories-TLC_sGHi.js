import{j as r}from"./jsx-dev-runtime-BETcGmrp.js";import{T as re}from"./index-DmOLfB1G.js";import{B as se,K as C}from"./index-CWEZQE0G.js";import{h as l,H as d}from"./index-Dt5PkBs3.js";import{b as te,u as w,s as oe,d as ae,e as ne,f as k,g as me,c as ie,a as ue}from"./store-CMG6tZte.js";import{g as ce,r as pe,a as le}from"./getSendRegSms-CYepBx4p.js";import{g as de,r as he,a as fe}from"./getSendAuthSms-CU1YpHbx.js";import{c as Ne}from"./utils-Bgs-dzIv.js";import{r as o}from"./index-BdMw_Ax9.js";import{u as x}from"./useMutation-Djmu82TW.js";import{u as xe,C as ye}from"./index.esm-aGtwzpR0.js";import{c as be,a as Se,o as ve}from"./object-BGxo6DNn.js";import{I as De}from"./IntroHeader-DCiaQ80g.js";import{I as Ee}from"./InfoLink-C6_5icqN.js";import{S as ge}from"./StyledButton-BfTgqHe6.js";import{S as _e}from"./StyledOptInput-bocisnaV.js";import{S as we}from"./StyledRipple-UT5xWoNU.js";import{u as ke}from"./StyledToast-DSRo3MwN.js";import{g as Ve}from"./getBeginRegistrer-BSiGL4TP.js";import{p as Te}from"./postFlutterData-Bn1e_q0-.js";import{a as je,b as Ue}from"./index-BmGp6xc6.js";import{P as Re}from"./Provider-C_7POvRj.js";import{d as h}from"./delay-DW_e480v.js";import"./iframe-DNwh6oNd.js";import"../sb-preview/runtime.js";import"./index-BSE0ybse.js";import"./mapValues-BXPElCjX.js";import"./index-BU6WCtrf.js";import"./index-C-I6vmrZ.js";import"./index-BvvlT_10.js";import"./index-DrFu-skq.js";import"./index-zmhHS-aW.js";import"./mutation-B5pq8hhe.js";import"./QueryClientProvider-DLasFzzO.js";import"./jsx-runtime-B_9IJGoR.js";import"./utils-km2FGkQ4.js";import"./ArrowIcon-DVFHFDWJ.js";import"./CloseIcon-BosYNr9-.js";import"./api.esm-CK-Pl4SF.js";import"./ripple.esm-CEskJZ5p.js";import"./portal.esm-CvrWT0gn.js";import"./index-ByRWxq36.js";const Ie=be({code:Se().required("Введите код безопасности").length(4,"Укажите код полностью")});function B(){var _;const s=te(),a=je(),$=Ue(),{StyledToast:O,showToast:L}=ke(),n=w(e=>e.user.phoneValue),[t,y]=o.useState(60),b=w(e=>e.user.apiToken),[S,K]=o.useState(""),[v,q]=o.useState(""),[D,W]=o.useState(""),{handleSubmit:X,control:z,reset:E,setError:g,formState:{errors:N}}=xe({defaultValues:{code:""},resolver:ve(Ie)}),{mutate:J,isPending:Q}=x({mutationFn:ce,onSuccess:e=>{s(k(e.result.api_token)),a("/auth/fio")},onError:e=>{E(),g("code",{type:"custom",message:e.message})}}),{mutate:Y,isPending:Z}=x({mutationFn:de,onSuccess:e=>{var m;s(k(e.apiToken)),s(me(!0)),b&&S&&v&&D&&Te({api_token:b,platformType:S,deviceId:v,fireToken:D}),e.lastPurchase?a(`/rate-store/${(m=e==null?void 0:e.lastPurchase)==null?void 0:m.id}/auth`):a("/")},onError:e=>{E(),g("code",{type:"custom",message:e.message})}}),{mutate:ee}=x({mutationFn:Ve,onMutate:()=>{L({variant:"info",text:`На номер ${n} повторно отправлен SMS-код`})}});return o.useEffect(()=>{const e=setInterval(()=>{t>0&&y(t-1)},1e3);return()=>clearInterval(e)},[t]),o.useEffect(()=>{try{window.routes5.flutterIsWorking&&(window.flutter_inappwebview.callHandler("handlerPlatformOs").then(e=>{K(e["X-PlatformType"])}),window.flutter_inappwebview.callHandler("handlerDeviceId").then(e=>{q(e["device:id"])}),window.flutter_inappwebview.callHandler("handlerRegistreNotification").then(e=>{window.flutter_inappwebview.callHandler("handlerFirebaseToken").then(m=>{W(m["firebase:token"])})}))}catch{console.log("Error with flutter")}return()=>{s(oe()),s(ae(""))}},[]),r.jsxDEV("div",{className:"flex h-dvh flex-col",children:[null,r.jsxDEV(De,{arrowAction:()=>{a(-1)},closeAction:()=>{a(-1)},className:"px-2 pt-2"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:162,columnNumber:7},this),r.jsxDEV("div",{className:"flex flex-grow flex-col px-3 pb-7 pt-[14px]",children:[r.jsxDEV("h1",{className:"pb-6 font-Inter text-base/5 font-bold text-212121",children:["Вы получите смс на номер",r.jsxDEV("br",{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:175,columnNumber:11},this)," ",n]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:173,columnNumber:9},this),r.jsxDEV("p",{className:Ne("pb-[14px] font-Inter text-[0.688rem]/[0.875rem] font-medium text-8D929A",{"text-D50032":N.code}),children:(_=N.code)==null?void 0:_.message},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:178,columnNumber:9},this),r.jsxDEV("form",{onSubmit:X(e=>{s(ne(e.code)),$.state==="register"?J({phone:n.replace(/\D/g,""),code:e.code}):Y({phone:n.replace(/\D/g,""),code:e.code})}),className:"flex flex-grow flex-col",children:[r.jsxDEV(ye,{name:"code",control:z,defaultValue:"",render:({field:e})=>r.jsxDEV(_e,{error:!!N.code,...e},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:208,columnNumber:36},this)},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:204,columnNumber:11},this),r.jsxDEV(ge,{type:"submit",label:"Далее",loading:Q||Z,className:"mt-auto"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:211,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:186,columnNumber:9},this),r.jsxDEV("button",{disabled:t!==0,className:"relative mt-[18px] min-h-9 overflow-hidden rounded-md border-0 text-center font-Inter text-xs/[1.125rem] font-medium text-D50032 disabled:text-8D929A",onClick:()=>{y(60),ee(n.replace(/\D/g,""))},children:[t!==0?`Не получили СМС? Повторная отправка возможна через ${t} секунд`:"Отправить код повторно",r.jsxDEV(we,{pt:{root:{style:{background:"rgba(145, 47, 70, 0.3)"}}}},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:225,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:214,columnNumber:9},this),r.jsxDEV(Ee,{className:"m-auto mt-[10px]",to:"/info",text:"Инфо"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:232,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:172,columnNumber:7},this),r.jsxDEV(O,{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:234,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:159,columnNumber:5},this)}B.__docgenInfo={description:"",methods:[],displayName:"Sms"};const f=({children:s})=>r.jsxDEV(Re,{store:ie({reducer:{user:ue({name:"user",initialState:{apiToken:"mock_api_tocken_123456789",phoneValue:"+7 915 457 24 90"},reducers:{}}).reducer}}),children:s},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:11,columnNumber:3},void 0),Dr={title:"Страницы/Aутентификация/Sms",component:B,tags:["autodocs"],decorators:[se],parameters:{layout:{padded:!1},docs:{page:()=>r.jsxDEV(r.Fragment,{children:[r.jsxDEV(re,{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:53,columnNumber:11},void 0),r.jsxDEV("h2",{children:"Адрес страницы: /auth/sms"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:54,columnNumber:11},void 0),r.jsxDEV("h3",{children:"Используемые запросы:"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:55,columnNumber:11},void 0),r.jsxDEV("p",{children:["getBeginRegister() - VITE_GET_BEGIN_REGISTER - ","https://preprod.premiya.fivecorners.ru/api/loymax/beginRegister?scenario=reg"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:57,columnNumber:11},void 0),r.jsxDEV("p",{children:["getSendRegSms() - VITE_GET_SEND_REG_SMS - ","https://preprod.premiya.fivecorners.ru/api/loymax/phoneCode"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:58,columnNumber:11},void 0),r.jsxDEV("p",{children:["getSendAuthSms() - VITE_GET_SEND_AUTH_SMS - ","https://preprod.premiya.fivecorners.ru/api/loymax/auth"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:59,columnNumber:11},void 0),r.jsxDEV("p",{children:["postFlutterData() - VITE_POST_FLUTTER_DATA - ","https://preprod.premiya.fivecorners.ru/api/page/sendUserDevice"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:60,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:52,columnNumber:9},void 0)}}},i={name:"Sms - рег",decorators:[s=>r.jsxDEV(f,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:73,columnNumber:25},void 0)],parameters:{msw:{handlers:[l.get("https://preprod.premiya.fivecorners.ru/api/loymax/phoneCode",async()=>(await h(2e3),d.json(pe)))]},reactRouter:C({location:{state:"register"}})}},u={name:"Sms - рег ошибка",decorators:[s=>r.jsxDEV(f,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:93,columnNumber:25},void 0)],parameters:{msw:{handlers:[l.get("https://preprod.premiya.fivecorners.ru/api/loymax/phoneCode",async()=>(await h(2e3),d.json(le)))]},reactRouter:C({location:{state:"register"}})}},c={name:"Sms - аутентификация",decorators:[s=>r.jsxDEV(f,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:113,columnNumber:25},void 0)],parameters:{msw:{handlers:[l.get("https://preprod.premiya.fivecorners.ru/api/loymax/auth",async()=>(await h(2e3),d.json(he)))]}}},p={name:"Sms - аутентификация - ошибка",decorators:[s=>r.jsxDEV(f,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:128,columnNumber:25},void 0)],parameters:{msw:{handlers:[l.get("https://preprod.premiya.fivecorners.ru/api/loymax/auth",async()=>(await h(2e3),d.json(fe)))]}}};var V,T,j;i.parameters={...i.parameters,docs:{...(V=i.parameters)==null?void 0:V.docs,source:{originalSource:`{
  name: 'Sms - рег',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_REG_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseRegSuccess);
      })]
    },
    reactRouter: reactRouterParameters({
      location: {
        state: 'register'
      }
    })
  }
}`,...(j=(T=i.parameters)==null?void 0:T.docs)==null?void 0:j.source}}};var U,R,I;u.parameters={...u.parameters,docs:{...(U=u.parameters)==null?void 0:U.docs,source:{originalSource:`{
  name: 'Sms - рег ошибка',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_REG_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseRegError);
      })]
    },
    reactRouter: reactRouterParameters({
      location: {
        state: 'register'
      }
    })
  }
}`,...(I=(R=u.parameters)==null?void 0:R.docs)==null?void 0:I.source}}};var A,P,M;c.parameters={...c.parameters,docs:{...(A=c.parameters)==null?void 0:A.docs,source:{originalSource:`{
  name: 'Sms - аутентификация',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_AUTH_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseAuthSuccess);
      })]
    }
  }
}`,...(M=(P=c.parameters)==null?void 0:P.docs)==null?void 0:M.source}}};var H,G,F;p.parameters={...p.parameters,docs:{...(H=p.parameters)==null?void 0:H.docs,source:{originalSource:`{
  name: 'Sms - аутентификация - ошибка',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_AUTH_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseAuthError);
      })]
    }
  }
}`,...(F=(G=p.parameters)==null?void 0:G.docs)==null?void 0:F.source}}};const Er=["Primary","PrimaryError","PrimaryAuth","PrimaryAuthError"];export{i as Primary,c as PrimaryAuth,p as PrimaryAuthError,u as PrimaryError,Er as __namedExportsOrder,Dr as default};
