import{j as e}from"./jsx-dev-runtime-BETcGmrp.js";import{T as ee}from"./index-BeJuocB0.js";import{u as re,a as se,B as te,K as F}from"./index-JTdNR3QG.js";import{h as d,H as h}from"./index-Dt5PkBs3.js";import{b as oe,u as w,s as ae,d as ne,e as me,f as ie,g as ue,c as ce,a as pe}from"./store-Z64qRVOu.js";import{g as le,r as de,a as he}from"./getSendRegSms-CqmRJwGh.js";import{g as fe,r as Ne,a as xe}from"./getSendAuthSms-CU1YpHbx.js";import{c as ye}from"./utils-Bgs-dzIv.js";import{r as o}from"./index-BdMw_Ax9.js";import{u as y}from"./useMutation-Djmu82TW.js";import{u as be,C as Se}from"./index.esm-aGtwzpR0.js";import{c as ve,a as De,o as Ee}from"./object-BGxo6DNn.js";import{I as _e}from"./IntroHeader-DCiaQ80g.js";import{I as ge}from"./InfoLink-C8LO3gVV.js";import{S as we}from"./StyledButton-BfTgqHe6.js";import{S as ke}from"./StyledOptInput-bocisnaV.js";import{S as Ve}from"./StyledRipple-UT5xWoNU.js";import{u as Te}from"./StyledToast-ChYbD6sG.js";import{g as je}from"./getBeginRegistrer-LJP2-HFL.js";import{p as Ue}from"./postFlutterData-Bn1e_q0-.js";import{P as Re}from"./Provider-BJPChQtn.js";import{d as f}from"./delay-DW_e480v.js";import"./iframe-DfDEsFaS.js";import"../sb-preview/runtime.js";import"./index-BSE0ybse.js";import"./mapValues-BXPElCjX.js";import"./index-BU6WCtrf.js";import"./index-C-I6vmrZ.js";import"./index-BvvlT_10.js";import"./index-DrFu-skq.js";import"./index-zmhHS-aW.js";import"./mutation-B5pq8hhe.js";import"./QueryClientProvider-DLasFzzO.js";import"./jsx-runtime-B_9IJGoR.js";import"./utils-km2FGkQ4.js";import"./ArrowIcon-DVFHFDWJ.js";import"./CloseIcon-BosYNr9-.js";import"./api.esm-CK-Pl4SF.js";import"./ripple.esm-CEskJZ5p.js";import"./portal.esm-CvrWT0gn.js";import"./index-ByRWxq36.js";const Ie=ve({code:De().required("Введите код безопасности").length(4,"Укажите код полностью")});function C(){var g;const s=oe(),a=re(),B=se(),{StyledToast:$,showToast:O}=Te(),n=w(r=>r.user.phoneValue),[t,b]=o.useState(60),m=w(r=>r.user.apiToken),[S,L]=o.useState(""),[v,K]=o.useState(""),[D,q]=o.useState(""),{handleSubmit:W,control:X,reset:E,setError:_,formState:{errors:x}}=be({defaultValues:{code:""},resolver:Ee(Ie)}),{mutate:z,isPending:J}=y({mutationFn:le,onSuccess:()=>{a("/auth/fio")},onError:r=>{E(),_("code",{type:"custom",message:r.message})}}),{mutate:Q,isPending:Y}=y({mutationFn:fe,onSuccess:r=>{var i;s(ie(r.apiToken)),s(ue(!0)),m&&S&&v&&D&&Ue({api_token:m,platformType:S,deviceId:v,fireToken:D}),r.lastPurchase?a(`/rate-store/${(i=r==null?void 0:r.lastPurchase)==null?void 0:i.id}/auth`):a("/")},onError:r=>{E(),_("code",{type:"custom",message:r.message})}}),{mutate:Z}=y({mutationFn:je,onMutate:()=>{O({variant:"info",text:`На номер ${n} повторно отправлен SMS-код`})}});return o.useEffect(()=>{const r=setInterval(()=>{t>0&&b(t-1)},1e3);return()=>clearInterval(r)},[t]),o.useEffect(()=>{try{window.routes5.flutterIsWorking&&(window.flutter_inappwebview.callHandler("handlerPlatformOs").then(r=>{L(r["X-PlatformType"])}),window.flutter_inappwebview.callHandler("handlerDeviceId").then(r=>{K(r["device:id"])}),window.flutter_inappwebview.callHandler("handlerRegistreNotification").then(r=>{window.flutter_inappwebview.callHandler("handlerFirebaseToken").then(i=>{q(i["firebase:token"])})}))}catch{console.log("Error with flutter")}return()=>{s(ae()),s(ne(""))}},[]),e.jsxDEV("div",{className:"flex h-dvh flex-col",children:[null,e.jsxDEV(_e,{arrowAction:()=>{a(-1)},closeAction:()=>{a(-1)},className:"px-2 pt-2"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:161,columnNumber:7},this),e.jsxDEV("div",{className:"flex flex-grow flex-col px-3 pb-7 pt-[14px]",children:[e.jsxDEV("h1",{className:"pb-6 font-Inter text-base/5 font-bold text-212121",children:["Вы получите смс на номер",e.jsxDEV("br",{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:174,columnNumber:11},this)," ",n]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:172,columnNumber:9},this),e.jsxDEV("p",{className:ye("pb-[14px] font-Inter text-[0.688rem]/[0.875rem] font-medium text-8D929A",{"text-D50032":x.code}),children:(g=x.code)==null?void 0:g.message},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:177,columnNumber:9},this),e.jsxDEV("form",{onSubmit:W(r=>{s(me(r.code)),B.state==="register"?z({api_token:m||"",code:r.code}):Q({phone:n,code:r.code})}),className:"flex flex-grow flex-col",children:[e.jsxDEV(Se,{name:"code",control:X,defaultValue:"",render:({field:r})=>e.jsxDEV(ke,{error:!!x.code,...r},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:207,columnNumber:36},this)},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:203,columnNumber:11},this),e.jsxDEV(we,{type:"submit",label:"Далее",loading:J||Y,className:"mt-auto"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:210,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:185,columnNumber:9},this),e.jsxDEV("button",{disabled:t!==0,className:"relative mt-[18px] min-h-9 overflow-hidden rounded-md border-0 text-center font-Inter text-xs/[1.125rem] font-medium text-D50032 disabled:text-8D929A",onClick:()=>{b(60),Z(n.replace(/\D/g,""))},children:[t!==0?`Не получили СМС? Повторная отправка возможна через ${t} секунд`:"Отправить код повторно",e.jsxDEV(Ve,{pt:{root:{style:{background:"rgba(145, 47, 70, 0.3)"}}}},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:224,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:213,columnNumber:9},this),e.jsxDEV(ge,{className:"m-auto mt-[10px]",to:"/info",text:"Инфо"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:231,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:171,columnNumber:7},this),e.jsxDEV($,{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:233,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.tsx",lineNumber:158,columnNumber:5},this)}C.__docgenInfo={description:"",methods:[],displayName:"Sms"};const N=({children:s})=>e.jsxDEV(Re,{store:ce({reducer:{user:pe({name:"user",initialState:{apiToken:"mock_api_tocken_123456789",phoneValue:"+7 915 457 24 90"},reducers:{}}).reducer}}),children:s},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:11,columnNumber:3},void 0),vr={title:"Страницы/Aутентификация/Sms",component:C,tags:["autodocs"],decorators:[te],parameters:{layout:{padded:!1},docs:{page:()=>e.jsxDEV(e.Fragment,{children:[e.jsxDEV(ee,{},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:53,columnNumber:11},void 0),e.jsxDEV("h2",{children:"Адрес страницы: /auth/sms"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:54,columnNumber:11},void 0),e.jsxDEV("h3",{children:"Используемые запросы:"},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:55,columnNumber:11},void 0),e.jsxDEV("p",{children:["getBeginRegister() - VITE_GET_BEGIN_REGISTER - ","https://preprod.premiya.fivecorners.ru/api/loymax/beginRegister?scenario=reg"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:57,columnNumber:11},void 0),e.jsxDEV("p",{children:["getSendRegSms() - VITE_GET_SEND_REG_SMS - ","https://preprod.premiya.fivecorners.ru/api/loymax/phoneCode"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:58,columnNumber:11},void 0),e.jsxDEV("p",{children:["getSendAuthSms() - VITE_GET_SEND_AUTH_SMS - ","https://preprod.premiya.fivecorners.ru/api/loymax/auth"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:59,columnNumber:11},void 0),e.jsxDEV("p",{children:["postFlutterData() - VITE_POST_FLUTTER_DATA - ","https://preprod.premiya.fivecorners.ru/api/page/sendUserDevice"]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:60,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:52,columnNumber:9},void 0)}}},u={name:"Sms - рег",decorators:[s=>e.jsxDEV(N,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:73,columnNumber:25},void 0)],parameters:{msw:{handlers:[d.get("https://preprod.premiya.fivecorners.ru/api/loymax/phoneCode",async()=>(await f(2e3),h.json(de)))]},reactRouter:F({location:{state:"register"}})}},c={name:"Sms - рег ошибка",decorators:[s=>e.jsxDEV(N,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:93,columnNumber:25},void 0)],parameters:{msw:{handlers:[d.get("https://preprod.premiya.fivecorners.ru/api/loymax/phoneCode",async()=>(await f(2e3),h.json(he)))]},reactRouter:F({location:{state:"register"}})}},p={name:"Sms - аутентификация",decorators:[s=>e.jsxDEV(N,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:113,columnNumber:25},void 0)],parameters:{msw:{handlers:[d.get("https://preprod.premiya.fivecorners.ru/api/loymax/auth",async()=>(await f(2e3),h.json(Ne)))]}}},l={name:"Sms - аутентификация - ошибка",decorators:[s=>e.jsxDEV(N,{children:s()},void 0,!1,{fileName:"/Users/andrey/Documents/work/client_premia/src/app/routes/auth.sms/route.stories.tsx",lineNumber:128,columnNumber:25},void 0)],parameters:{msw:{handlers:[d.get("https://preprod.premiya.fivecorners.ru/api/loymax/auth",async()=>(await f(2e3),h.json(xe)))]}}};var k,V,T;u.parameters={...u.parameters,docs:{...(k=u.parameters)==null?void 0:k.docs,source:{originalSource:`{
  name: 'Sms - рег',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_REG_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseRegSuccess);
      })]
    },
    reactRouter: reactRouterParameters({
      location: {
        state: 'register'
      }
    })
  }
}`,...(T=(V=u.parameters)==null?void 0:V.docs)==null?void 0:T.source}}};var j,U,R;c.parameters={...c.parameters,docs:{...(j=c.parameters)==null?void 0:j.docs,source:{originalSource:`{
  name: 'Sms - рег ошибка',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_REG_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseRegError);
      })]
    },
    reactRouter: reactRouterParameters({
      location: {
        state: 'register'
      }
    })
  }
}`,...(R=(U=c.parameters)==null?void 0:U.docs)==null?void 0:R.source}}};var I,A,P;p.parameters={...p.parameters,docs:{...(I=p.parameters)==null?void 0:I.docs,source:{originalSource:`{
  name: 'Sms - аутентификация',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_AUTH_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseAuthSuccess);
      })]
    }
  }
}`,...(P=(A=p.parameters)==null?void 0:A.docs)==null?void 0:P.source}}};var M,H,G;l.parameters={...l.parameters,docs:{...(M=l.parameters)==null?void 0:M.docs,source:{originalSource:`{
  name: 'Sms - аутентификация - ошибка',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: [http.get(import.meta.env.VITE_GET_SEND_AUTH_SMS, async () => {
        await delay(2000);
        return HttpResponse.json(responseAuthError);
      })]
    }
  }
}`,...(G=(H=l.parameters)==null?void 0:H.docs)==null?void 0:G.source}}};const Dr=["Primary","PrimaryError","PrimaryAuth","PrimaryAuthError"];export{u as Primary,p as PrimaryAuth,l as PrimaryAuthError,c as PrimaryError,Dr as __namedExportsOrder,vr as default};
