import{r as l}from"./index-DGAqIW1f.js";import{g as v,R as h}from"./store-B5FxAW76.js";function w(){const i=v();let s=null,r=null;return{clear(){s=null,r=null},notify(){i(()=>{let t=s;for(;t;)t.callback(),t=t.next})},get(){let t=[],n=s;for(;n;)t.push(n),n=n.next;return t},subscribe(t){let n=!0,e=r={callback:t,next:null,prev:r};return e.prev?e.prev.next=e:s=e,function(){!n||s===null||(n=!1,e.next?e.next.prev=e.prev:r=e.prev,e.prev?e.prev.next=e.next:s=e.next)}}}}const S={notify(){},get:()=>[]};function C(i,s){let r,t=S,n=0,e=!1;function c(g){a();const m=t.subscribe(g);let p=!1;return()=>{p||(p=!0,m(),d())}}function f(){t.notify()}function o(){b.onStateChange&&b.onStateChange()}function u(){return e}function a(){n++,r||(r=s?s.addNestedSub(o):i.subscribe(o),t=w())}function d(){n--,r&&n===0&&(r(),r=void 0,t.clear(),t=S)}function y(){e||(e=!0,a())}function x(){e&&(e=!1,d())}const b={addNestedSub:c,notifyNestedSubs:f,handleChangeWrapper:o,isSubscribed:u,trySubscribe:y,tryUnsubscribe:x,getListeners:()=>t};return b}const E=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",L=E?l.useLayoutEffect:l.useEffect;function M({store:i,context:s,children:r,serverState:t,stabilityCheck:n="once",noopCheck:e="once"}){const c=l.useMemo(()=>{const u=C(i);return{store:i,subscription:u,getServerState:t?()=>t:void 0,stabilityCheck:n,noopCheck:e}},[i,t,n,e]),f=l.useMemo(()=>i.getState(),[i]);L(()=>{const{subscription:u}=c;return u.onStateChange=u.notifyNestedSubs,u.trySubscribe(),f!==i.getState()&&u.notifyNestedSubs(),()=>{u.tryUnsubscribe(),u.onStateChange=void 0}},[c,f]);const o=s||h;return l.createElement(o.Provider,{value:c},r)}export{M as P};
