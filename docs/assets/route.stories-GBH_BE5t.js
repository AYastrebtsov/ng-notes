import{j as e}from"./jsx-runtime-_e34SzbC.js";import{T as R,D as V}from"./index-Bsd13j-q.js";import{h as x,d as p,H as d}from"./utils-CLBOLGHf.js";import{u as T,a as S,s as A,c as L,b as F}from"./store-DdwlwKBF.js";import{c as K}from"./utils-B6PcESyr.js";import{r as y}from"./index-DVXBtNgz.js";import{c as U,a as J,u as q,b as g,Y as Q,C as G,o as W}from"./YaMetrika-CDuY83lx.js";import{I as Y}from"./IntroHeader-CrfB3o8S.js";import{I as X}from"./InfoLink-DG0rSC0t.js";import{S as Z}from"./StyledButton-CKROTuB7.js";import{S as O}from"./StyledOptInput-B4qGEzBe.js";import{S as $}from"./StyledRipple-CNImIO0m.js";import{u as ee}from"./StyledToast-_thc0YPA.js";import{g as te}from"./getBeginRegistrer-CqUgC1eM.js";import{a as re}from"./index-BojaLiPF.js";import{P as se}from"./Provider-CQC4cIn_.js";import"./iframe-BWFzkPgu.js";import"../sb-preview/runtime.js";import"./index-CMHnigvr.js";import"./mapValues-BA7I9QKQ.js";import"./index-RMSiDl4v.js";import"./index-C-I6vmrZ.js";import"./index-8IunTYrG.js";import"./index-DrFu-skq.js";import"./QueryClientProvider--9jJntYg.js";import"./ArrowIcon-nbckv7rS.js";import"./index-yeJ0zlv8.js";import"./api.esm-vZf3A5nu.js";import"./ripple.esm-D99TQ-Py.js";import"./iconbase.esm-JCNRNy3-.js";import"./extends-CCbyfPlC.js";const oe=async({api_token:t,code:r})=>{const a=new URL("https://premialoyality.ru/api/loymax/phoneCode");a.searchParams.append("api_token",t),a.searchParams.append("code",r);const i=await fetch(a);if(!i.ok)throw new Error("Произошел сбой запроса. Повторите попытку");const o=await i.json();if(o.status==="Error")throw new Error(o.result.result.message);if(o.result.result.state==="Error")throw new Error(o.result.result.message);if(o.result.data===void 0)throw new Error("Не удалось получить ответ");return o},P={result:{data:{token_type:"bearer",access_token:"qEolVCQ-UBzLFkob2xk2pQbGdh8ngx72kOXDjc6h345N5iKifee6G0biAPysrrmwP9Zly5HpoOZikI4hLmagsPP0qx9bHp3KuMTSpkzFQ8zXzJool1iMfy_wynVDdMd9s5CEKYQpvDDIcAL9zIrRU-vaM_ML843pPBPV3MJyrJreo8k5S7uaGH8k9EfZPLw9ujJoiVWtdIBk3zzJKq_PoK8M__M16BWOlz0nidP38kL4T2nqADNPctQHiJl4Hlzrl1eihSKb8dIcnuEahByzxBLrxfPIh3mVOzhj_54MJMCHWd2J5UXm7bc85dBkz2ueDd9XKzH0z7dqgZPIH58HpiPYCQExcspNAKk-umP3kBG80yVZw02iFBUnM_WsKPpNP_i4gUE5D4WsXB1lDoQIYeEWAUUrEynhYBNmFFShTRI",refresh_token:"5ba5163545d54f29a35ed65b469afb41",expires_in:2592e3},result:{state:"Success",httpCode:200,message:null,messageCode:null,exception:null,validationErrors:null}},status:"Success"},I={result:{result:{state:"Error",httpCode:400,message:"Неправильный код подтверждения. Осталось 6 попыток.",messageCode:null,exception:null,validationErrors:null}},status:"Error"};x.get("https://premialoyality.ru/api/loymax/phoneCode",async({request:t})=>new URL(t.url).searchParams.get("scenario")==="error"?(await p(2e3),d.json(I)):(await p(2e3),d.json(P)));const ae=U({code:J().length(4).required()}),ne=(t,r)=>t===void 0&&r===null?"Введите код безопасности":t!==void 0&&r===null?"Укажите код полностью":t===void 0&&r!==null||t!==void 0&&r!==null?"Неверный код безопасности":"Введите код безопасности";function v(){const t=T(),r=re(),{StyledToast:a,showToast:i}=ee(),o=S(s=>s.user.apiToken),m=S(s=>s.user.phoneValue),[n,f]=y.useState(60),{handleSubmit:D,control:N,reset:C,formState:{errors:u}}=q({defaultValues:{code:""},resolver:W(ae)}),{mutate:B,error:h,isPending:z}=g({mutationFn:oe,onSuccess:()=>{r("/fio")},onError:()=>{C()}}),{mutate:H}=g({mutationFn:te,onMutate:()=>{i({variant:"info",text:`На номер ${m} повторно отправлен SMS-код`})}});return y.useEffect(()=>{const s=setInterval(()=>{n>0&&f(n-1)},1e3);return()=>clearInterval(s)},[n]),e.jsxs("div",{className:"flex h-dvh flex-col",children:[e.jsx(Q,{}),e.jsx(Y,{arrowAction:()=>{r(-1)},closeAction:()=>{r(-1)},className:"px-2 pt-2"}),e.jsxs("div",{className:"flex flex-grow flex-col px-3 pb-7 pt-[14px]",children:[e.jsxs("h1",{className:"pb-6 font-Inter text-base/5 font-bold text-212121",children:["Вы получите смс на номер",e.jsx("br",{})," ",m]}),e.jsx("p",{className:K("pb-[14px] font-Inter text-[0.688rem]/[0.875rem] font-medium text-8D929A",{"text-D50032":u.code},{"text-D50032":h}),children:ne(u.code,h)}),e.jsxs("form",{onSubmit:D(s=>{console.log(s),t(A(s.code)),B({api_token:o||"",code:s.code})}),className:"flex flex-grow flex-col",children:[e.jsx(G,{name:"code",control:N,defaultValue:"",render:({field:s})=>e.jsx(O,{error:u.code?!0:h!==null,...s})}),e.jsx(Z,{type:"submit",label:"Далее",loading:z,className:"mt-auto"})]}),e.jsxs("button",{disabled:n!==0,className:"relative mt-[18px] min-h-9 overflow-hidden rounded-md border-0 text-center font-Inter text-xs/[1.125rem] font-medium text-D50032 disabled:text-8D929A",onClick:()=>{f(60),H(m.replace(/\D/g,""))},children:[n!==0?`Не получили СМС? Повторная отправка возможна через ${n} секунд`:"Отправить код повторно",e.jsx($,{pt:{root:{style:{background:"rgba(145, 47, 70, 0.3)"}}}})]}),e.jsx(X,{className:"m-auto mt-[10px]",to:"/info",text:"Инфо"})]}),e.jsx(a,{})]})}v.__docgenInfo={description:"",methods:[],displayName:"Sms"};const M=({children:t})=>e.jsx(se,{store:L({reducer:{user:F({name:"user",initialState:{apiToken:"mock_api_tocken_123456789",phoneValue:"+7 915 457 24 90"},reducers:{}}).reducer}}),children:t}),Te={title:"Страницы/Sms",component:v,tags:["autodocs"],parameters:{layout:{padded:!1},docs:{page:()=>e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(V,{})]}),description:{component:`<p>Адрес страницы: /sms</p>
<p>Используемые запросы:</p>
<p>getSendSms() - VITE_SEND_SMS - https://premialoyality.ru/api/loymax/phoneCode</p>
<p>getBeginRegister() - VITE_BEGIN_REGISTER - https://premialoyality.ru/api/loymax/beginRegister</p>`}}}},l={name:"Sms",decorators:[t=>e.jsx(M,{children:t()})],parameters:{msw:{handlers:{auth:x.get("https://premialoyality.ru/api/loymax/phoneCode",async()=>(await p(2e3),d.json(P)))}}}},c={name:"Sms - ошибка",decorators:[t=>e.jsx(M,{children:t()})],parameters:{msw:{handlers:{auth:x.get("https://premialoyality.ru/api/loymax/phoneCode",async()=>(await p(2e3),d.json(I)))}}}};var E,j,k;l.parameters={...l.parameters,docs:{...(E=l.parameters)==null?void 0:E.docs,source:{originalSource:`{
  name: 'Sms',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: {
        auth: http.get(import.meta.env.VITE_SEND_SMS, async () => {
          await delay(2000);
          return HttpResponse.json(responseSuccess);
        })
      }
    }
  }
}`,...(k=(j=l.parameters)==null?void 0:j.docs)==null?void 0:k.source}}};var b,_,w;c.parameters={...c.parameters,docs:{...(b=c.parameters)==null?void 0:b.docs,source:{originalSource:`{
  name: 'Sms - ошибка',
  decorators: [story => <Mockstore>{story()}</Mockstore>],
  parameters: {
    msw: {
      handlers: {
        auth: http.get(import.meta.env.VITE_SEND_SMS, async () => {
          await delay(2000);
          return HttpResponse.json(responseError);
        })
      }
    }
  }
}`,...(w=(_=c.parameters)==null?void 0:_.docs)==null?void 0:w.source}}};const Ae=["Primary","PrimaryError"];export{l as Primary,c as PrimaryError,Ae as __namedExportsOrder,Te as default};
